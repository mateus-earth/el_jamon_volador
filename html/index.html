<!DOCTYPE html>
<html>

<head>
    <title>Pollen Boy</title>
    <meta charset='UTF-8'>

    <link rel='stylesheet' href='css/index.css'>
    <link rel='shortcut icon' href='img/favicon.png' type='image/png'>
</head>

<body>
    <canvas id='nanacanvas' class='screen' width='160' height='144'></canvas>

    <!----- Scripts ----->
    <script src="./modules/external/gameboy/src/cpu.js"></script>
    <script src="./modules/external/gameboy/src/ops.js"></script>
    <script src="./modules/external/gameboy/src/mem.js"></script>
    <script src="./modules/external/gameboy/src/ppu.js"></script>
    <script src="./modules/external/gameboy/src/apu.js"></script>
    <script src="./modules/external/gameboy/src/joypad.js"></script>
    <script src="./modules/external/gameboy/src/main.js"></script>

    <script>
        window.onload = function () {
            const canvas = document.getElementById('nanacanvas');
            const gb = new Gameboy();
            gb.AttachCanvas(canvas);

            // Default settings
            gb.SetFPS(60); // 120 is performant but 60 is smoother
            gb.bootromEnabled = false;
            gb.SetPallete(['fff6d3', 'f9a875', 'eb6b6f', '7c3f58']);

            // const defaultVolume = 0.05;
            // gb.SetVolume (defaultVolume);
            // gb.EnableSound ();

            gb.DisableAlphaBlend();
            gb.SetAlphaBlend(0.7);

            gb.keyboardEnabled = true;

            fetch("./rom/el-jamon-volador_1.2.0.gb")
                .then(response => response.blob())
                .then(blob => {
                    const fileReader = new FileReader();

                    fileReader.onload = () => {
                        const fileData = new Uint8Array(fileReader.result);
                        gb.InsertRom(fileData);
                        gb.Start();
                    };
                    fileReader.readAsArrayBuffer(blob);
                })
                .catch(error => {
                    console.error(error);
                });
        }
    </script>
</body>

</html>